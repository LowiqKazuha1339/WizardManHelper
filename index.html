<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>wizardmanhelper</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f7f7f7; }
    #board {
      display: grid;
      grid-template-columns: repeat(7, 60px);
      grid-template-rows: repeat(6, 60px);
      gap: 4px;
      justify-content: center;
      margin-top: 20px;
    }
    .cell {
      width: 60px; height: 60px;
      background: white; border-radius: 50%; border: 2px solid #333;
    }
    .ai { background: gold; }
    #result { margin-top: 20px; font-size: 1.2em; color: #222; }
  </style>
</head>
<body>

<h2>wizardmanhelper</h2>
<div id="board"></div>
<div id="result"></div>

<script>
  const ROWS = 6, COLS = 7, AI = 2;
  let board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
  let aiStepPlaced = false;

  const boardDiv = document.getElementById('board');
  const resultDiv = document.getElementById('result');

  function renderBoard() {
    boardDiv.innerHTML = '';
    for (let r = 0; r < ROWS; r++) {
      for (let c = 0; c < COLS; c++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        if (board[r][c] === AI) cell.classList.add('ai');
        cell.dataset.row = r;
        cell.dataset.col = c;
        cell.addEventListener('click', () => {
          if (!aiStepPlaced) placeAIColumn(c);
        });
        boardDiv.appendChild(cell);
      }
    }
  }

  function getAvailableRow(col) {
    for (let r = ROWS - 1; r >= 0; r--) {
      if (board[r][col] === 0) return r;
    }
    return -1;
  }

  function placeAIColumn(col) {
    const row = getAvailableRow(col);
    if (row === -1) return;
    board[row][col] = AI;
    aiStepPlaced = true;
    renderBoard();
    const nextMove = getBestMove();
    resultDiv.textContent = `✅ 推荐下一步落子列: 第 ${nextMove + 1} 列`;
  }

  function getValidLocations() {
    return [...Array(COLS).keys()].filter(c => board[0][c] === 0);
  }

  function copyBoard(b) {
    return b.map(row => [...row]);
  }

  function isWin(tempBoard, player) {
    for (let r = 0; r < ROWS; r++) {
      for (let c = 0; c < COLS - 3; c++) {
        if (tempBoard[r][c] === player &&
            tempBoard[r][c + 1] === player &&
            tempBoard[r][c + 2] === player &&
            tempBoard[r][c + 3] === player) return true;
      }
    }
    for (let c = 0; c < COLS; c++) {
      for (let r = 0; r < ROWS - 3; r++) {
        if (tempBoard[r][c] === player &&
            tempBoard[r + 1][c] === player &&
            tempBoard[r + 2][c] === player &&
            tempBoard[r + 3][c] === player) return true;
      }
    }
    for (let r = 0; r < ROWS - 3; r++) {
      for (let c = 0; c < COLS - 3; c++) {
        if (tempBoard[r][c] === player &&
            tempBoard[r + 1][c + 1] === player &&
            tempBoard[r + 2][c + 2] === player &&
            tempBoard[r + 3][c + 3] === player) return true;
      }
    }
    for (let r = 3; r < ROWS; r++) {
      for (let c = 0; c < COLS - 3; c++) {
        if (tempBoard[r][c] === player &&
            tempBoard[r - 1][c + 1] === player &&
            tempBoard[r - 2][c + 2] === player &&
            tempBoard[r - 3][c + 3] === player) return true;
      }
    }
    return false;
  }

  function scoreBoard(tempBoard, player) {
    let score = 0;
    const center = Math.floor(COLS / 2);
    const centerCount = tempBoard.map(row => row[center]).filter(v => v === player).length;
    score += centerCount * 3;
    return score;
  }

  function minimax(tempBoard, depth, alpha, beta, maximizing) {
    const validLocations = getValidLocations();
    const isTerminal = isWin(tempBoard, AI) || isWin(tempBoard, 1) || validLocations.length === 0;
    if (depth === 0 || isTerminal) {
      if (isWin(tempBoard, AI)) return [null, 1000000];
      if (isWin(tempBoard, 1)) return [null, -1000000];
      return [null, scoreBoard(tempBoard, AI)];
    }

    if (maximizing) {
      let value = -Infinity, bestCol = validLocations[0];
      for (let col of validLocations) {
        const row = getAvailableRow(col);
        const newBoard = copyBoard(tempBoard);
        newBoard[row][col] = AI;
        const [, newScore] = minimax(newBoard, depth - 1, alpha, beta, false);
        if (newScore > value) {
          value = newScore;
          bestCol = col;
        }
        alpha = Math.max(alpha, value);
        if (alpha >= beta) break;
      }
      return [bestCol, value];
    } else {
      let value = Infinity, bestCol = validLocations[0];
      for (let col of validLocations) {
        const row = getAvailableRow(col);
        const newBoard = copyBoard(tempBoard);
        newBoard[row][col] = 1; // simulate player
        const [, newScore] = minimax(newBoard, depth - 1, alpha, beta, true);
        if (newScore < value) {
          value = newScore;
          bestCol = col;
        }
        beta = Math.min(beta, value);
        if (alpha >= beta) break;
      }
      return [bestCol, value];
    }
  }

  function getBestMove() {
    const [col] = minimax(copyBoard(board), 4, -Infinity, Infinity, true);
    return col;
  }

  renderBoard();
</script>
</body>
</html>
